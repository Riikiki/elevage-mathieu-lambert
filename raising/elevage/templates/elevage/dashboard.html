{% extends "base.html" %}

{% block content %}
  <div class="container">
    
    <h1 class="h1-dashboard">{{ elevage.nom }}</h1>

    <div class="columns">
      <div class="info-box">
        <h2>Informations générales :</h2>
        <ul class="info-list">
          {% comment %} Trying to update along the changes but it doesn't work i want to throw myself out of the window {% endcomment %}
          {% comment %} Nevermind I found it {% endcomment %}
          {% for field, value in elevage.getFieldsAndValues.items%}
            {% if field == 'solde' %}
              <li><strong>{{ field }} (en €):</strong> {{ value }}</li>
            {% elif field == 'quantite_nourriture' %}
              <li><strong>{{ field }}:</strong> {{ value }} kg</li>
            {% elif field == 'males' or field == 'femelles' %}
            
            {% else %}
              <li><strong>{{ field }}:</strong> {{ value }}</li>
            {% endif %}
            
          {% endfor %}
        </ul>
      
        <h2>Individus</h2>

        <button onclick="openPopup('popupMales')">Mâles ( {{ individus_males|length }} )</button>
        <button onclick="openPopup('popupFemales')">Femelles ( {{ individus_femelles|length }} )</button>

        <div class="health-stats">
          <h3>Statistiques de santé</h3>
          <ul>
            <li>Malades : {{ individus_malades|length }}</li>
            <li>En guérison : {{ individus_en_guerison|length }}</li>
            <li>Morts : {{ individus_morts|length }}</li>
          </ul>
        </div>

        <div id="popupMales" class="popup">
          <div class="popup-content">
            <span class="close" onclick="closePopup('popupMales')"> X </span>
            <h3>Mâles</h3>
            <ul>
              {% for male in individus_males %}
                <li>
                  Age : {{ male.age }} mois —
                  Santé : {% if male.sante %}{{ male.sante.get_etat_display }}{% else %}Non défini{% endif %}
                </li>
              {% empty %}
                <li>Aucun mâle trouvé.</li>
              {% endfor %}
            </ul>
          </div>
        </div>

        <div id="popupFemales" class="popup">
          <div class="popup-content">
            <span class="close" onclick="closePopup('popupFemales')"> X </span>
            <h3>Femelles</h3>
            <ul>
              {% for female in individus_femelles %}
                <li>
                  Age : {{ female.age }} mois —
                  Santé : {% if female.sante %}{{ female.sante.get_etat_display }}{% else %}Non défini{% endif %}
                </li>
              {% empty %}
                <li>Aucun femelle trouvée.</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>

      <div class="form-box">
        <h2>Actions du tour</h2>
        <form method="post">
          {% csrf_token %}
          {{ form.as_p }}
          <button type="submit">Valider le tour</button>
        </form>
        {% if message %}
          <p class="message">{{ message }}</p>
        {% endif %}
      </div>

      {% if form.errors %}
        <ul class="errorlist">
          {% for field in form %}
            {% for error in field.errors %}
              <li>{{ error }}</li>
            {% endfor %}
          {% endfor %}
          {% for error in form.non_field_errors %}
            <li>{{ error }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>

    <a href="{% url 'elevage_liste' %}">Retour à la liste</a>
  </div>

  <a onclick="openPopup('chatbotPopup')" 
     style="position: fixed; bottom: 20px; right: 20px; background: #4CAF50; color: white; padding: 10px 20px; border-radius: 50px; text-decoration: none; font-size: 18px; cursor: pointer;">
    Assistance
  </a>


  <div id="chatbotPopup" class="chatbot-popup">
    <div class="chatbot-header">
      <span>Fred, expert lapin</span>
      <span class="close" onclick="closePopup('chatbotPopup')" style="font-size : 30px; color : white"> x </span>
    </div>
    <div class="chatbot-body">
      <p><strong>Fred :</strong> Salut ! Je suis ton assistant éleveur. Je peux t'aider à
        prédire les prochaines naissances, à gérer tes animaux et à répondre à tes questions sur l'élevage.
        N'hésite pas à me poser des questions ! Je peux t'aider à :
        <ul style="font-size: 14px">
          <li>Prédire le prochain tour,</li>
          <li>À te donner des conseils,</li>
          <li>Savoir combien de bébé lapins tu auras au prochain tour.</li>
      </p>
    </div>
    <div class="chatbot-footer">
      <input type="text" id="chatbotInput" placeholder="Écrivez votre message..." />
      <button onclick="sendMessage('Needtobereplacedbyusername', {{ elevage_id }})" style="font-size: 15px">Envoyer</button>
    </div>
  </div>

{% endblock %}
